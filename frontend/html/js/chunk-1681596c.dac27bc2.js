(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1681596c"],{"35ae":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-row",{attrs:{justify:"center"}},[s("v-dialog",{attrs:{persistent:"","max-width":"290"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[s("v-card",[s("v-card-title",{staticClass:"headline"},[e._v("Ooooops!")]),s("v-card-text",{domProps:{innerHTML:e._s(e.message)}}),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:function(t){e.show=!1}}},[e._v("Ok")])],1)],1)],1)],1)},r=[],a={name:"DialogAlert",props:{value:Boolean,message:String},computed:{show:{get:function(){return this.value},set:function(e){this.$emit("input",e)}}}},n=a,o=s("2877"),l=Object(o["a"])(n,i,r,!1,null,null,null);t["a"]=l.exports},8418:function(e,t,s){"use strict";var i=s("c04e"),r=s("9bf2"),a=s("5c6c");e.exports=function(e,t,s){var n=i(t);n in e?r.f(e,n,a(0,s)):e[n]=s}},a434:function(e,t,s){"use strict";var i=s("23e7"),r=s("23cb"),a=s("a691"),n=s("50c4"),o=s("7b0b"),l=s("65f0"),c=s("8418"),u=s("1dde"),d=s("ae40"),m=u("splice"),p=d("splice",{ACCESSORS:!0,0:0,1:2}),h=Math.max,f=Math.min,v=9007199254740991,g="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!m||!p},{splice:function(e,t){var s,i,u,d,m,p,_=o(this),b=n(_.length),x=r(e,b),w=arguments.length;if(0===w?s=i=0:1===w?(s=0,i=b-x):(s=w-2,i=f(h(a(t),0),b-x)),b+s-i>v)throw TypeError(g);for(u=l(_,i),d=0;d<i;d++)m=x+d,m in _&&c(u,d,_[m]);if(u.length=i,s<i){for(d=x;d<b-i;d++)m=d+i,p=d+s,m in _?_[p]=_[m]:delete _[p];for(d=b;d>b-i+s;d--)delete _[d-1]}else if(s>i)for(d=b-i;d>x;d--)m=d+i-1,p=d+s-1,m in _?_[p]=_[m]:delete _[p];for(d=0;d<s;d++)_[d+x]=arguments[d+2];return _.length=b-i+s,u}})},a623:function(e,t,s){"use strict";var i=s("23e7"),r=s("b727").every,a=s("a640"),n=s("ae40"),o=a("every"),l=n("every");i({target:"Array",proto:!0,forced:!o||!l},{every:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},c975:function(e,t,s){"use strict";var i=s("23e7"),r=s("4d64").indexOf,a=s("a640"),n=s("ae40"),o=[].indexOf,l=!!o&&1/[1].indexOf(1,-0)<0,c=a("indexOf"),u=n("indexOf",{ACCESSORS:!0,1:0});i({target:"Array",proto:!0,forced:l||!c||!u},{indexOf:function(e){return l?o.apply(this,arguments)||0:r(this,e,arguments.length>1?arguments[1]:void 0)}})},ed81:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("v-card",[s("v-subheader",[e._v(" Users "),s("v-spacer"),"write"==e.permission?s("v-btn",{attrs:{icon:""}},[s("v-btn",{attrs:{color:"pink",dark:"",fab:"",fixed:"",small:""},on:{click:e.addItem}},[s("v-icon",[e._v("mdi-plus")])],1)],1):e._e()],1),s("v-card-title",[s("v-text-field",{attrs:{"append-icon":"mdi-magnify",label:"Filter","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),s("v-data-table",{attrs:{headers:e.headers,items:e.users,search:e.search,"sort-by":"username"},scopedSlots:e._u([{key:"item.superuser",fn:function(t){var i=t.item;return[s("v-simple-checkbox",{attrs:{disabled:""},model:{value:i.permissions.superuser,callback:function(t){e.$set(i.permissions,"superuser",t)},expression:"item.permissions.superuser"}})]}},"write"==e.permission?{key:"item.actions",fn:function(t){var i=t.item;return[s("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editItem(i)}}},[e._v(" mdi-pencil ")]),s("v-icon",{attrs:{small:""},on:{click:function(t){return e.deleteItem(i)}}},[e._v(" mdi-delete ")])]}}:null],null,!0)})],1),[s("user-item",{attrs:{item:e.item,title:""==e.item._id?"New user":"Edit user",save:e.saveItem,devices:e.devices},model:{value:e.item_dialog,callback:function(t){e.item_dialog=t},expression:"item_dialog"}})],[s("dialog-confirm",{attrs:{title:"Are you sure?",message:e.confirm_message,confirm:e.confirmDeleteItem},model:{value:e.confirm_dialog,callback:function(t){e.confirm_dialog=t},expression:"confirm_dialog"}})],[s("dialog-alert",{attrs:{message:e.alert_message},model:{value:e.alert_dialog,callback:function(t){e.alert_dialog=t},expression:"alert_dialog"}})]],2)},r=[],a=(s("a623"),s("c975"),s("a434"),s("35ae")),n=s("b2d1"),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-row",{attrs:{justify:"center"}},[s("v-dialog",{attrs:{"max-width":"500px"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[s("v-card",[s("v-card-title",[s("span",{staticClass:"headline"},[e._v(e._s(e.title))])]),s("v-card-text",[s("v-tabs",{attrs:{"fixed-tabs":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[s("v-tab",{key:"general"},[e._v("General")]),e.item.permissions.superuser?e._e():s("v-tab",{key:"permissions"},[e._v("Permissions")]),s("v-tabs-items",{model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[s("v-tab-item",{key:"general"},[s("v-container",[s("v-row",[s("v-col",{attrs:{cols:"12",sm:"12",md:"6"}},[s("v-text-field",{attrs:{label:"Username*",autofocus:""},model:{value:e.item.username,callback:function(t){e.$set(e.item,"username",t)},expression:"item.username"}})],1),s("v-col",{attrs:{cols:"12",sm:"12",md:"6"}},[s("v-text-field",{attrs:{label:"Login*"},model:{value:e.item.login,callback:function(t){e.$set(e.item,"login",t)},expression:"item.login"}})],1),s("v-col",{attrs:{cols:"12",sm:"12",md:"6"}},[s("v-text-field",{attrs:{label:"Password",type:"password"},model:{value:e.item.password,callback:function(t){e.$set(e.item,"password",t)},expression:"item.password"}})],1),s("v-col",{attrs:{cols:"12",sm:"12",md:"6"}},[s("v-text-field",{attrs:{label:"Confirm password",type:"password"},model:{value:e.item.password2,callback:function(t){e.$set(e.item,"password2",t)},expression:"item.password2"}})],1),s("v-col",{attrs:{cols:"12",sm:"12",md:"6"}},[s("v-switch",{attrs:{label:"Superuser"},model:{value:e.item.permissions.superuser,callback:function(t){e.$set(e.item.permissions,"superuser",t)},expression:"item.permissions.superuser"}})],1)],1)],1),s("small",[e._v("*indicates required field")])],1),s("v-tab-item",{key:"permissions"},[s("div",[s("v-select",{attrs:{items:e.permissions,label:"Devices"},model:{value:e.item.permissions.devices,callback:function(t){e.$set(e.item.permissions,"devices",t)},expression:"item.permissions.devices"}})],1),s("div",[s("v-select",{attrs:{items:e.permissions,label:"Reports"},model:{value:e.item.permissions.reports,callback:function(t){e.$set(e.item.permissions,"reports",t)},expression:"item.permissions.reports"}})],1)])],1)],1)],1),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(t){e.show=!1}}},[e._v("Cancel")]),s("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.save}},[e._v("Save")])],1)],1)],1)],1)},l=[],c={name:"UserItem",data:function(){return{tab:0,permissions:["none","read","write"]}},props:{value:Boolean,item:Object,title:String,save:Function},computed:{show:{get:function(){return this.value},set:function(e){this.$emit("input",e)}}}},u=c,d=s("2877"),m=Object(d["a"])(u,o,l,!1,null,null,null),p=m.exports,h={data:function(){return{search:"",headers:[{text:"Username",align:"start",value:"username"},{text:"Login",value:"login"},{text:"Superuser",value:"superuser",filterable:!1,sortable:!1},{text:"Actions",value:"actions",filterable:!1,sortable:!1}],users:[],item:{permissions:{}},empty_item:{_id:"",username:"",login:"",permissions:{superuser:!1,devices:"none",users:"none",reports:"none"}},deleteIndex:-1,item_dialog:!1,confirm_dialog:!1,confirm_message:"",alert_dialog:!1,alert_message:""}},methods:{getList:function(){var e=this;this.$http.get("backend/users").then((function(t){200==t["status"]&&(e.users=t.data["users"]||{})})).catch((function(e){console.log(e)}))},addItem:function(){this.item=JSON.parse(JSON.stringify(this.empty_item)),this.item_dialog=!0},editItem:function(e){var t=this;this.$http.get("backend/user/"+e["_id"]).then((function(e){200==e["status"]&&("success"==e.data["status"]?(t.item=Object.assign(t.item,t.empty_item,e.data["data"]),t.item_dialog=!0):t.alert_dialog_open(e.data["error"]))})).catch((function(e){console.log(e),t.alert_dialog_open("something is wrong!")}))},deleteItem:function(e){this.deletedIndex=this.users.indexOf(e),this.confirm_message="Delete this user?<br/> You will not be able to recover it",this.confirm_dialog=!0},saveItem:function(){var e=this;if(this.check_input_data()){var t={};if(""==this.item.password||void 0==this.item.password)t={username:this.item.username,login:this.item.login,permissions:this.item.permissions};else{var i=s("1c46"),r=i.createHash("sha256");r.update(this.item.password),t={username:this.item.username,login:this.item.login,password:r.digest("hex"),permissions:this.item.permissions}}""===this.item._id?this.$http.post("backend/user/",t).then((function(s){200==s["status"]?"success"==s.data["status"]&&(e.users.push({_id:s.data.data,username:t.username,login:t.login,permissions:t.permissions,password:""}),e.item_dialog=!1):"error"==s.data["status"]&&e.alert_dialog_open(s.data["error"])})).catch((function(t){console.log(t),e.alert_dialog_open("something is wrong!")})):this.$http.put("backend/user/"+this.item._id,t).then((function(t){200==t["status"]&&("success"==t.data["status"]?e.users.every((function(t){return t._id!=e.item._id||(t=Object.assign(t,e.item),!1)})):"error"==t.data["status"]&&e.alert_dialog_open(t.data["error"])),e.item_dialog=!1})).catch((function(t){console.log(t),e.alert_dialog_open("something is wrong!")}))}},check_input_data:function(){if(""==this.item.username)return this.alert_dialog_open("Username is required"),!1;if(""==this.item.login)return this.alert_dialog_open("Login is required!"),!1;for(var e in this.users)if(this.users[e]._id!=this.item._id){if(this.users[e].username==this.item.username)return this.alert_dialog_open("Duplicated username!"),!1;if(this.users[e].login==this.item.login)return this.alert_dialog_open("Duplicated login!"),!1}return""==this.item.password&&""==this.item._id?(this.alert_dialog_open("Password is required!"),!1):""==this.item.password||this.item.password==this.item.password2||(this.alert_dialog_open("Passwords are different!"),!1)},alert_dialog_open:function(e){this.alert_dialog=!0,this.alert_message=e},confirmDeleteItem:function(){var e=this;this.$http.delete("backend/user/"+this.users[this.deletedIndex]["_id"]).then((function(t){200==t["status"]&&"success"==t.data["status"]&&e.users.splice(e.deletedIndex)})).catch((function(e){console.log(e)})),this.confirm_dialog=!1}},computed:{permission:function(){return this.$store.getters.permissions["superuser"]?"write":this.$store.getters.permissions["users"]}},created:function(){this.getList()},components:{DialogConfirm:n["a"],DialogAlert:a["a"],UserItem:p}},f=h,v=Object(d["a"])(f,i,r,!1,null,null,null);t["default"]=v.exports}}]);
//# sourceMappingURL=chunk-1681596c.dac27bc2.js.map